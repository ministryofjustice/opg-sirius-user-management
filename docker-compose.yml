version: "3.6"

services:
  app:
    build: .
    ports: ["8888:8888"]
    environment:
      PORT: 8888
      SIRIUS_URL: http://pact-stub:8080
      SIRIUS_PUBLIC_URL: http://localhost:8080

  pact-stub:
    image: pactfoundation/pact-stub-server
    ports: ["8080:8080"]
    command: ["-d", "pacts", "-p", "8080"]
    volumes:
      - type: volume
        source: pacts_data
        target: /app/pacts

  pa11y:
    build: ./docker/pa11y-ci
    depends_on:
      - app
      - pact-stub

volumes:
  pacts_data:
    name: pacts_data
    external: true
